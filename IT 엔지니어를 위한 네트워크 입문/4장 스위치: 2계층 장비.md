# 4장
- 스위치는 2계층 주소인 맥주소를 기반으로 동작한다.
- 스위치가 맥주소를 기반으로 동작하는 기본적인 내용에서 보다 깊게 들어가 스위치가 맥주소를 어떻게 이해하고 활용하는지 상세히 다룬다.
- 스위치의 기능
  - 맥주소를 인식하고 패킨을 전달하는 기본 동작
  - 한 대의 장비에서 논리적으로 네트워크를 분리하는 VLAN
  - 네트워크의 루프를 방지하는 스패닝 트리 프로토콜

  ## 4.1 스위치 장비 동작
  - 스위치는 네트워크에서 통신을 중재하는 장비
  - 스위치가 없던 이더넷 네트워크에서는 패킷을 전송할 때 서로 경합 그로 인한 네트워크 성능 저하 -> 경쟁을 없애고 패킷을 동시에 여러 장비가 간섭 없이 통신
  - 여러 단말이 한꺼번에 통신
  - MAC 주소 테이블
    >누가 어느 위치에 있는지 파악하고 실제 통신이 시작되면 자신이 알고 있는 위치로 패킷을 정확히 전송하는 것
    >이런 동작은 스위치가 2계층 주소를 이해하고 단말의 주소인 맥주소의 단말이 위치하는 인터페이스 정보를 매칭한 맥주소 테이블을 갖고 있어 가능
  - 스위치가 전송하려는 패킷의 목적지 맥주소를 확인하고 해당 포트에 보내려는데 그 정보가 맥주소 테이블에 없는 경우 아래와 같은 3가지 동작이 발생한다.
    1. 플러딩
    2. 어드레스 러닝
    3. 포워딩/필터링

  ### 4.1.1 플러딩
  - 처음에 스위치를 부팅하면 맥주소 테이블은 텅텅 비어있다.
  - 그래서 패킷이 도착하면 해당 패킷을 어디에 보내햘지 몰라 해당 스위치에 연결된 모든 포트에 보낸다 (왜냐하면 스위치는 로컬 영역에서만 동작하므로 어딘가에 장비가 있을거라 생각)
  - 그리고 해당 패킷이 스위치에 돌아오면 해당 패킷 정보의 맥주소를 보고 이를 학습해서 맥주소 테이블을 채운다. 
  - 하지만 이 플러딩 작업은 스위치가 본인의 역할을 제대로 하지 못하고 허브의 역할을 하는 것과 다름이 없는 것이다.
  - 비정상적인 플러딩
    - 이터넷 TCP/IP에서는 플러딩이 일어나지 않는데 그 이유는 ARP 브로드캐스트를 통해서 미리 목적지의 맥주소를 알 수 있기 때문이다.
    - 보내고자 하는 곳에만 포워딩 하므로 악의적으로 가로챌 수 없어서 스위치의 기능을 무력화해서 공격한다.
    - 예를 들어 맥주소 테이블을 가득 채워서 플러딩 동작을 유도하거나 엉뚱한 맥주소를 학습시킬 수 있다.
  ### 4.1.2 어드레스 러닝
  - 맥주소 테이블을 유지하는 과정
  - 패킷의 출발지 맥주소 정보를 이용 -> 패킷이 특정 포트에 들어오면 스위치에는 해당 패킷의 출발지 맥주소와 포트 번호를 맥주소 테이블에 기록
  - 따라서 목적지 맥주소 필드만을 이용하는 브로드캐스트와 멀티캐스트를 맥주소를 학습할 수 없다.
  - 사전 정의된 맥주소 테이블
    - 패킷을 처리하기 위한 맥주소가 아닌 대부분 스위치끼리의 통신을 위해서 사용
  ### 4.1.3 포워딩/필터링
  - 패킷이 스위치에 들어온 경우, 도착지 맥주소를 확인하고 자신이 가진 맥주소 테이블과 비교해 맞는 정보가 있으면 매치되는 해당 포트로 패킷을 포워딩
  - 다른 포트로는 패킷을 보내지 않으므로 이를 필터링
  - 스위치는 유니캐스트에 대해서만 포워딩과 필터링
## 4.2 VLAN
>하나의 물리 스위치에서 여러 개의 네트워크를 나누어 사용할 수 있는 VLAN의 종류와 특징, 실제로 어떻게 사용되는지 알아보자

### 4.2.1 VLAN이란?
- 물리적인 배치와 상관없이 LAN을 논리적으로 분할, 구성하는 기술
- 과도한 브로드캐스트로 이한 단말의 성능 저하, 보안 향상을 위한 차단 용도, 서비스 성격에 따른 정책 적용과 같은 이유로 네트워크 분리
![image](https://github.com/user-attachments/assets/5f057af9-2fc9-4056-8e1f-d45016675d35)
- VLAN과의 통신을 위해서는 L3 장비가 필요하다
- 물리적으로 다른 층에 있는 단말이 하나의 VLAN을 사용해 동일한 네트워크로 묶을 수 있다.
### 4.2.2 VLAN의 종류와 특징
할당 방식
- 포트기반
  - VLAN 처음 개념 = 포트기반
  - 왜냐하면 스위치는 고가였고 여러 허브를 묶는 역할을 스위치가 담당했기 때문에 스위치를 분할 해 여러 네트워크에 사용하는 것이 VLAN 적용 목적
- 맥주소 기반
  - 사용자들의 자리 이동이 많아지면서 맥 기반 VLAN 개발 = 다이나믹 VLAN
### 4.2.3 VLAN 모드 동작 방식
- 앞서 배웠지만 VLAN끼리는 통신할 수 없으므로 3계층 장비 필요
![image](https://github.com/user-attachments/assets/562980e7-4af7-453d-bc83-251d14f8ebd7)
- 여러 개의 VLAN이 여러 개의 스위치에 퍼져있는 경우 서로 같은 VLAN끼리 통신하기 위해서는 스위치에 VLAN을 연결하기 위한 전용 포트가 필요하다
- 즉 이 말은 대형 네트워크에서 VLAN별로 통신을 위한 포트 연결을 통해 많은 포트가 낭비된다.

태그 포트 or 트렁크 포트
- 위와 같은 상황을 방지하기 위해서 하나의 포트에 여러 개의 VLAN을 함께 전송하는 것이 태그 포트 or 트렁크 포트이다.
- 이에 따라 태그 포트로 패킷을 보낼 때는 VLAN ID를 함께 보내는데 이 데이터를 통해서 어떤 VLAN과 통신하는지 알 수 있다.
- VLAN이 생겨남에 따라 스위치에서 관리하는 맥주소 테이블에도 변화가 발생함 다른 VLAN끼리 통신하지 못하도록 VLAN을 지정하는 필드가 생겼다.
- 일반적인 포트 = 서버를 연결하는 포트 = 언테크 포트 = 엑세스 포트
- 태크 포트 = 트렁크 포트 = 스위치 간 여러 개의 VLAN끼리 통신하기 위한 포트
