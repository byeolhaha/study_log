# 9.1 보안
- 정보 보안이란
  우리가 생산하거나 유지해야 할 정보에 위험이 발생하거나 사고나 날 염려 없이 편안한 상태를 유지하는 것
- 3대 요소
  - 기밀성 : 인가되지 않은 사용자에게 정보를 보여주지 않는 것
  - 무결성 : 정확하고 완정한 정보를 유지하는 것 -> 대표적 무결성 기술 md5, sha
  - 가용성 : 정보가 필요할 때 정보 접근을 허용하는 것
- 네트워크 보안의 주요 개념
  - 트러스트 네트워크 : 우리가 운영하는 내부 네트워크로 보호해야할 영역 
  - 언트러스트 네트워크 : 외부에서 운영하는 네트워크로 믿을 수 없는 영역
  - DMZ :  우리가 운영하는 내부 네트워크이지만 신뢰할 수 없는 외부에게 개방해야하는 영역
- 트래픽의 방향과 용도에 따라
  - 인터넷 시큐어 게이트웨이 : 트러스트(혹은 DMZ)에서 언트러스트 네트워크 통신을 통제
  - 데이터 센터 시큐어 게이트웨이 : 언트러스트 네트워크에서 트러스트(DMZ) 네트워크 통신을 통제
- 네트워크 보안 정책 수립에 따라
  - 화이트리스트 :  말그대로 허용할 네트워크 설정
  - 블랙리스트 :  허용하지 않을 네트워크 설정

# 9.2 보안 솔루션의 종류
- 해커들의 공격이 악랄해지고 발전하기 때문에 기존 장비에 계속 추가되는 형태
- 형태 : DDOS 방어장비 - 방화벽 - IPS(시그니처) - 웹 방화벽(WAF) - 서버
## DDoS 방어장비
- Dos 공격은 하나의 IP에서 지속적으로 공격하기 때문에 IP 주소 기반 방어가 가능하나 DDoS 공격은 이런 탐지를 회피하기 위해서 다수의 봇에서 공격을 한다.
- 이 공격은 볼륨메트릭 공격의 경우 다수의 공격으로 회선을 마비시키기 때문에 이를 막기위한 장비는 데이터 센터와 외부 네트워크 사이에 존재한다.
## 방화벽
- 4계층에서 동작하는 패킷 필터링 장비
- 비교적 간단하게 동작
## IDS(Instrustion Detection System), IPS(Instrustion Prevetion System)
- 방화벽에서 방어할 수 없는 다양한 애플리케이션 공격을 방어하는 장비
- 공격 데이터베이스를 제조사나 위협 인텔리젼스 서비스 업체로부터 받아서 이 데이터베이스 기반으로 블랙리스트 기반의 방어 방식을 제공받는다.
- 최근에는 화이트리스트 기반으로도 작동할 수 있다고 한다.

## WAF(Web Application Firewall)
-  웹 서버를 보호하는 전용 보안 장비, HTTP, HTTPS처럼 웹 서버에서 동작하는 웹 프로토콜 공격을 방어
-  IDS.IPS 장비보다 범용성이 떨어지지만 HTTP, HTTPS와 같은 웹 프로토콜에 대해서는 더 세밀히 방어
-  WAF는 IPS에서 방어할 수 없는 IPS 회피 공격을 방어할 수 있다.
-  IPS는 데이터를 조합하지 않고 처리하지만 WAF는 프록시 서버와 같이 패킷을 데이터 형태로 조합해서 처리 -> 그래서 회피 공격을 쉽게 만들기 어렵다
## 샌드박스
- 직접적인 공격이 아닌 악성 코드를 관리자 PC에 우회적으로 심고 이 악성 코드를 이용해서 관리자 PC를 컨트롤하는 방식
- 유명한 웹사이트에 악성코드가 담긴 파일을 올리고 이를 사용자들이 다운로드받도록 해서 악성코드에 감염시킴 이 악성 코드를 다운받은 Pc는 원격제어가 가능하다
- 이 원격제어는 C&C 서버에서 진행한다.
- 기존 방화벽에서는 내부 사용자가 외부 서버로 통신을 정상적으로 시도한 것으로 보이므로 이 공격을 검출하거나 방어할 수 없음
- 그래서 샌드박스는 이러한 공격을 방어하는 대표적인 장비, 악성 코드를 샌드박스 시스템 안에서 직접 실행시킴
- 가상 운영체제 안에서 각종 파일을 직접 실행시키고 그 행동을 모니터링해 그 파일들의 악성 코드 여부를 판별한다.
## NAC(Network Access Control)
- 네트워크에 접속하는 장치를 제어
- 네트워크에 접속할 때 인가된 사용자만 내부망 접속할 수 있도록 인가받기 전이나 승인에 실패한 사용자는 접속할 수 없도록 함
## IP 제어
- NAC 솔루션과 비슷하지만 국내에서는 다른 목적
- 고정 IP 사용을 권고함 -> 금융권에 내려오면서 IP를 할당하고 추적하는 솔루션이 필요, 할당된 IP를 관리하고 나아가 정확히 의도된 IP할당이 아니면 정상적으로 네트워크를 사용하지 못하게 하는 기능
## 접근통제(Bastion Host : 배스천 호스트)
- 서버나 데이터베이스에 대한 직접적인 접근을 막고 작업 추적 및 감사를 할 수 있는 접근 통제 솔루션 개발
- 서버 접근을 위한 모든 통신은 베스턴 호스트를 통해서만 가능
- 서버 호스트의 방화벽에 베스턴 호스트에서 출발한 통신만 허용하고 다른 통신은 모두 방어하도록 설정
## VPN
- 사용자 기반의 VPN 서비스를 제공해주는 장비
# 9.3 방화벽
## 9.3.1 방화벽의 정의
- 네트워크 중간에 위치해 해당 장비를 통과하는 트래픽을 사전에 주어진 정책 조건에 맞추어 허용하거나 차단하는 장비
- 네트워크 3,4 계층에서 동작하며 세션을 인지하는 상태 기반 엔진으로 동작
## 9.3.2 초기 방화벽
- 패킷의 인과 관계를 확인하지 못하고 등록된 정책만으로만 패킷을 필터링 = 스테이트리스 또는 패킷 필터 방화벽
- 5-튜플을 참고하여 설정된 정책과 일치하는지 확인
  - 5튜플은 source port, source ip, destination port, destination ip, protocal no
- 하지만 이 방식은 인터넷 통신과 같이 불특정 다수 기반의 정책을 정의할 때 복잡해진다 왜냐하면 불특정다수이므로 등록할 정책이 무수히 많아진다
- 또한 5튜플 외의 3,4 계층 혜더를 변조해서 공격하면 적절히 방어가 불가능하다.
- 하지만 이 방식은 다른 세대의 방화벽보다 부하가 적고 간단하다
## 9.3.3 상태 기반의 방화벽 SPI 엔진의 방화벽
- 기존 패킷 기반의 방화벽의 한계점을 극복하기 위해 현재 사용하는 방화벽은 세션 기반으로 동작하는 상태 기반 방화벽
- 패킷 기반의 방화벽은 불특정 다수와의 통신이나 양방향을 인지하지 못한다.
- 상태기반은 내부에서 외부로 나갔으면 이는 내부에서 해당 포트와 ip를 허용하다고 보고 반대 방향도 허용함
## 9.3.4 방화벽 동작 방식
![image](https://github.com/user-attachments/assets/6c50714c-2ec7-4135-ba61-155cdb1c2531)

- SPI 엔진을 가진 방화벽은 세션 인지 기능이 있어 단순히 5튜플 조건만 확인하는 것이 아니라 OSI 3,4 계층의 세부적인 필드도 함꼐 확인
- TCP 컨트롤 플래그에 따라 동작 방식이 변하거나 시퀀스와 ACK 번호가 갑자기 변경되는 것을 인지해서 세션 탈취 공격을 일부 방어할 수 있다.
## ALG
- 방화벽은 3,4 계층에서 동작하지 때문에 애플리케이션 헤더 정보는 인지할 수 없음
- 따라서 FTP와 같은 컨트롤 프로토콜과 데이터 프로토콜이 나눠져 있고 통신 방향이 서로 반대인 경우에는 정상적인 서비스가 불가능할 수 있다.
- FTP 기본 동작 방식
  1. 클라이언트는 랜덤 포트 2000을 통해 서버 커맨드 

