## 유지보수 작업을 할 때는 독립 실행형 서버로 전환하기
책에 말이 좀 어렵게 나와있는데
결국 한 서버가 복제 셋이면 유지보수 작업이 성능에 영향을 주기 때문에 복제셋에서 분리 시켜 독립 실행형 서버로 전환해서 유지보수 작업을 진행하고 다시 복제셋에 합류시키라는 이야기이다.

몇 가지 절차가 있는데 먼저

1. 아래 명령어를 통해서 해당 서버의 정보를 얻는다.
  ```
mdbDefGuide [direct: primary] test> db.serverCmdLineOpts()
{
  argv: [
    'mongod',
    '--replSet',
    'mdbDefGuide',
    '--dbpath',
    '/Users/kimbyeol/data/rs3',
    '--port',
    '27020',
    '--logpath',
    '/Users/kimbyeol/data/rs3/mongod.log'
  ],
  parsed: {
    net: { port: 27020 },
    replication: { replSet: 'mdbDefGuide' },
    storage: { dbPath: '/Users/kimbyeol/data/rs3' },
    systemLog: {
      destination: 'file',
      path: '/Users/kimbyeol/data/rs3/mongod.log'
    }
  },
  ok: 1,
  '$clusterTime': {
    clusterTime: Timestamp({ t: 1726903508, i: 1 }),
    signature: {
      hash: Binary.createFromBase64('AAAAAAAAAAAAAAAAAAAAAAAAAAA=', 0),
      keyId: Long('0')
    }
  },
   operationTime: Timestamp({ t: 1726903508, i: 1 })
 }

  ```
 결과를 해석해보면 아래와 같다.

 - argv (명령줄 인수):
   1. 'mongod': MongoDB 데몬(mongod) 실행 파일을 실행했다는 것을 나타냅니다.
   2. '--replSet', 'mdbDefGuide': MongoDB가 복제 셋(replica set) 모드로 실행되고 있으며, 복제 셋의 이름은 'mdbDefGuide'입니다.
   3. '--dbpath', '/Users/kimbyeol/data/rs3': MongoDB 데이터 파일이 저장되는 경로가 /Users/kimbyeol/data/rs3라는 것을 나타냅니다.
   4. '--port', '27020': MongoDB가 27020 포트에서 실행되고 있습니다.
   5. '--logpath', '/Users/kimbyeol/data/rs3/mongod.log': 로그 파일은 /Users/kimbyeol/data/rs3/mongod.log에 기록됩니다.
 - parsed (분석된 설정):
  - net.port: 네트워크 포트가 27020임을 나타냅니다.
  - replication.replSet: 복제 셋의 이름이 'mdbDefGuide'로 설정되어 있습니다.
  - storage.dbPath: 데이터가 저장되는 경로가 /Users/kimbyeol/data/rs3입니다.
  - systemLog.path: 로그 파일이 /Users/kimbyeol/data/rs3/mongod.log에 저장됩니다.
 - ok: 1:
 이 값은 명령이 성공적으로 실행되었음을 나타냅니다.
 - $clusterTime, operationTime:
  이 섹션은 MongoDB가 클러스터 환경에서 시간 동기화를 유지하기 위해 사용하는 타임스탬프 관련 정보입니다. 클러스터 타임(clusterTime)과 특정 작업의 타임스탬프(operationTime)이 기록되어 있으며, 이는 MongoDB가 복제본 간의 데이터 일관성을 유지하기 위한 메커니즘의 일환입니다.

2. 해당 서버를 종료한다.
   ```
   db.shutdownServer()
   ```
3. 독립 실행형 서버로 실행한다.
   - replSet 옵션 없이 서버를 재시작
   - 기존 서버와 다른 포트
   - 서버 데이터를 조작하기 위해 dbpath는 그대로 유지
   ```
   mongod --port 30000 --dbpath /Users/kimbyeol/data/rs3
   {"t":{"$date":"2024-09-21T16:35:49.783+09:00"},"s":"I",  "c":"CONTROL",  "id":23285,   "ctx":"thread1","msg":"Automatically disabling TLS 1.0, to force-enable TLS 1.0 specify --sslDisabledProtocols 'none'"}
   {"t":{"$date":"2024-09-21T16:35:49.785+09:00"},"s":"I",  "c":"NETWORK",  "id":4915701, "ctx":"thread1","msg":"Initialized wire specification","attr":{"spec":{"incomingExternalClient":{"minWireVersion":0,"maxWireVersion":21},"incomingInternalClient":{"minWireVersion":0,"maxWireVersion":21},"outgoing":{"minWireVersion":6,"maxWireVersion":21},"isInternalClient":true}}{"t":{"$date":"2024-09-21T16:35:50.055+09:00"},"s":"I",  "c":"STORAGE",  "id":5380103, "ctx":"initandlisten","msg":"Unpin oldest timestamp request","attr":{"service":"_wt_startup","requestedTs":{"$timestamp":{"t":1726903683,"i":1}}}}
   {"t":{"$date":"2024-09-21T16:35:50.055+09:00"},"s":"I",  "c":"FTDC",     "id":20625,   "ctx":"initandlisten","msg":"Initializing full-time diagnostic data capture","attr":{"dataDirectory":"/Users/kimbyeol/data/rs3/diagnostic.data"}}
   ...
   {"t":{"$date":"2024-09-21T16:35:50.057+09:00"},"s":"W",  "c":"CONTROL",  "id":20547,   "ctx":"initandlisten","msg":"Document(s) exist in 'system.replset', but started without --replSet. Database contents may appear inconsistent with the writes that were visible when this node was running as part of a replica set. Restart with --replSet unless you are doing maintenance and no other clients are connected. The TTL collection monitor will not start because of this. For more info see http://dochub.mongodb.org/core/ttlcollections","tags":["startupWarnings"]}
   {"t":{"$date":"2024-09-21T16:35:50.057+09:00"},"s":"W",  "c":"CONTROL",  "id":7692300, "ctx":"initandlisten","msg":"Replica set member is in standalone mode. Performing any writes will result in them being untimestamped. If a write is to an existing document, the document's history will be overwritten with the new value since the beginning of time. This can break snapshot isolation within the storage engine.","tags":["startupWarnings"]}
   ```
